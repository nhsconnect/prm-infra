version: 0.2

phases:
  pre_build:
    commands:
      - echo $PATH
      - id
      - which jq
      - which terraform
      - which terragrunt
      - ls -l $(which jq)
      - ls -l $(which terraform)
      - ls -l $(which terragrunt)
      - export ASSUME_ROLE_NAME=arn:aws:iam::431593652018:role/PASTASLOTHVULGAR
      - chmod a+x ./utils/*
      - eval $(./utils/aws-cli-assumerole.sh -r $ASSUME_ROLE_NAME)
      - export TF_WARN_OUTPUT_ERRORS=true
  build:
    commands:
      - cd ./terraformscripts/dev-431593652018/assume_role 
      - terragrunt init --terragrunt-source-update
      - terragrunt validate
      - terragrunt apply -auto-approve
